## 数据库原理大作业设计文档

张驰 2018010139

孙沛瑜 2019013284

王政 2019012282

### 完成目标

实现create table语句，可以有多个属性，但是只能有一个主键

实现drop table语句

实现show table语句

实现insert into语句

实现update语句

实现delete语句

实现select语句，支持join（必须同时有on子句），where，当有两个表进行操作时，所有属性都必须包含表名，即使用全名来操作。

实现事务操作时加锁

实现重启server时能够通过日志文件还原数据

### 实验结果

演示了创建数据库，创建表，插入值的功能

![](1.png)

演示了筛选数据，更新数据，插入数据的功能。

![](2.png)

演示了关闭server之后重启server，client与server先断开连接再重新连接数据还原

![](3.png)

演示了删除表项的功能

![](4.png)

演示了join的筛选功能

![](5.png)

演示了show table语句

![](6.png)

在事务未并发时，能够正常进行访问

![](8.png)

在两个client处理事务时，一个事务未提交时，另一个事务无法读取该事务修改过的表的信息

![](9.png)

在一个事务提交了之后，另一个事务就能够结束堵塞继续进行了

![](10.png)

演示了show table和drop table的功能

![](11.png)

### 实现方法

#### SQL语句

#### 事务并发



#### 恢复数据

修改给定代码中的Manager.writeLog，在输出时增加当前的session（用于不同的事务之间进行操作），即同时输出session和操作语句。

当实现恢复时，依次读取每一条语句，执行readLog函数，先提取出session的值，再将session的值和语句一起调用sqlHandler.evaluate函数，使用该函数重新执行该运行语句，使数据库根据日志的内容进行数据恢复。

此处因为evaluate函数中，我们将writeLog的条件修改为了session>=0就进行输出（不同的client会获得不同的值为自然数的session），所以在调用evaluate函数前先将session赋值为了-session-1，这样将其变成了负数，又易于重新恢复原值。